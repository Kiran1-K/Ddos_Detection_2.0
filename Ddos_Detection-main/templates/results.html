{% extends "base.html" %}

{% block content %}
<h2>üìä Detection Results</h2>

<!-- DDoS Attack Status -->
{% if detect_info and 'is_ddos' in detect_info %}
<div class="card p-3 mb-4 shadow-sm {% if detect_info.is_ddos %}border-danger{% else %}border-success{% endif %}">
    <h4>
        {% if detect_info.is_ddos %}
        üö® DDoS Attack Detected!
        <span class="badge bg-danger">{{ detect_info.attack_type }}</span>
        {% else %}
        ‚úÖ No DDoS Attack Detected
        <span class="badge bg-success">Normal Traffic</span>
        {% endif %}
    </h4>
    
    {% if detect_info.is_ddos %}
    <div class="mt-3">
        <h5>Attack Details:</h5>
        <p><strong>Attack Type:</strong> {{ detect_info.attack_type }}</p>
        <p><strong>Confidence:</strong> {{ "%.1f"|format(detect_info.confidence * 100) }}%</p>
        
        {% if 'indicators' in detect_info and detect_info.indicators %}
        <h6>Attack Indicators:</h6>
        <ul class="list-group">
            {% for indicator in detect_info.indicators %}
            <li class="list-group-item">
                <strong>{{ indicator.name }}:</strong> {{ indicator.value }}
                <span class="badge bg-warning float-end">
                    {{ "%.1f"|format(indicator.confidence * 100) }}% confidence
                </span>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Anomaly Summary -->
{% if detect_info and 'n_anomalies' in detect_info %}
<div class="card p-3 mb-4 shadow-sm">
    <h5>üìä Anomaly Detection Summary</h5>
    <div class="row">
        <div class="col-md-6">
            <div class="card {% if detect_info.n_anomalies > 0 %}bg-light-warning{% else %}bg-light-success{% endif %} p-3">
                <h6>Total Samples Analyzed</h6>
                <h3>{{ detect_info.total_samples }}</h3>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card {% if detect_info.n_anomalies > 0 %}bg-light-danger{% else %}bg-light-success{% endif %} p-3">
                <h6>Anomalies Detected</h6>
                <h3>{{ detect_info.n_anomalies }}</h3>
            </div>
        </div>
    </div>
    {% if detect_info.anomaly_percent is defined %}
    <div class="mt-3">
        <div class="progress" style="height: 25px;">
            <div class="progress-bar bg-{% if detect_info.anomaly_percent > 5 %}danger{% else %}success{% endif %}" 
                 role="progressbar" 
                 style="width: {{ detect_info.anomaly_percent }}%" 
                 aria-valuenow="{{ detect_info.anomaly_percent }}" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
                {{ "%.1f"|format(detect_info.anomaly_percent) }}%
            </div>
        </div>
        <small class="text-muted">Percentage of traffic identified as anomalous</small>
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Visualization Section -->
<div class="row">
    <!-- Error Histogram -->
    {% if error_hist_file %}
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">üìä Reconstruction Error Distribution</h5>
                <p class="card-text">Shows the distribution of reconstruction errors. The red dashed line indicates the anomaly threshold.</p>
                <img src="{{ url_for('static', filename=error_hist_file) }}" class="img-fluid rounded" alt="Error Histogram">
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Time Series Plot -->
    {% if time_series_plot %}
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">‚è±Ô∏è Traffic Analysis</h5>
                <p class="card-text">Shows traffic patterns and detected anomalies over time.</p>
                <img src="{{ url_for('static', filename=time_series_plot) }}" class="img-fluid rounded" alt="Time Series Analysis">
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Detailed Results -->
{% if csv_file %}
<div class="card p-3 mb-4 shadow-sm">
    <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">üì• Download Results</h5>
        <a href="{{ url_for('download_results') }}" class="btn btn-primary">
            <i class="bi bi-download"></i> Download Full Results (CSV)
        </a>
    </div>
    <p class="text-muted mt-2">The CSV file contains detailed detection results for each packet/flow.</p>
</div>
{% endif %}

<!-- Raw Summary -->
{% if summary_text %}
<div class="card p-3 shadow-sm">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">üîç Detailed Detection Log</h5>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#rawLog" aria-expanded="false" aria-controls="rawLog">
            Toggle Details
        </button>
    </div>
    <div class="collapse" id="rawLog">
        <pre class="bg-light p-3 rounded">{{ summary_text }}</pre>
    </div>
</div>
{% endif %}

<style>
    /* Main Container */
    #content {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px;
        animation: fade-in 0.6s ease-out;
    }

    @keyframes fade-in {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Main Heading */
    h2 {
        text-align: center;
        font-size: 2.8rem;
        font-weight: 700;
        margin-bottom: 40px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
        animation: slide-down 0.8s ease-out;
    }

    @keyframes slide-down {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Card Enhancements */
    .card {
        border-radius: 20px;
        border: none;
        transition: all 0.3s ease;
        background: #ffffff;
        overflow: hidden;
        position: relative;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        background-size: 200% 100%;
        animation: gradient-slide 3s linear infinite;
    }

    @keyframes gradient-slide {
        0% { background-position: 0% 0%; }
        100% { background-position: 200% 0%; }
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
    }

    .shadow-sm {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
    }

    /* DDoS Alert Card */
    .card.border-danger {
        border: 3px solid #dc3545 !important;
        background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
        animation: pulse-danger 2s ease-in-out infinite;
    }

    @keyframes pulse-danger {
        0%, 100% {
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.2);
        }
        50% {
            box-shadow: 0 8px 35px rgba(220, 53, 69, 0.4);
        }
    }

    .card.border-success {
        border: 3px solid #28a745 !important;
        background: linear-gradient(135deg, #f0fff4 0%, #e8f5e9 100%);
    }

    /* Status Badges */
    .badge {
        padding: 8px 16px;
        font-size: 0.95rem;
        font-weight: 600;
        border-radius: 20px;
        animation: badge-pop 0.5s ease-out;
    }

    @keyframes badge-pop {
        0% {
            transform: scale(0);
        }
        70% {
            transform: scale(1.1);
        }
        100% {
            transform: scale(1);
        }
    }

    .badge.bg-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%) !important;
        box-shadow: 0 4px 15px rgba(238, 90, 111, 0.4);
    }

    .badge.bg-success {
        background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%) !important;
        box-shadow: 0 4px 15px rgba(55, 178, 77, 0.4);
    }

    .badge.bg-warning {
        background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%) !important;
        color: #000 !important;
    }

    /* Stats Cards */
    .bg-light-warning {
        background: linear-gradient(135deg, #fff9e6 0%, #fff3cc 100%) !important;
        border-left: 5px solid #fbbf24;
    }

    .bg-light-success {
        background: linear-gradient(135deg, #f0fff4 0%, #e8f5e9 100%) !important;
        border-left: 5px solid #28a745;
    }

    .bg-light-danger {
        background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%) !important;
        border-left: 5px solid #dc3545;
    }

    .card h3 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2d3748;
        margin-top: 10px;
        animation: count-up 0.8s ease-out;
    }

    @keyframes count-up {
        from {
            opacity: 0;
            transform: scale(0.5);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* Progress Bar */
    .progress {
        border-radius: 15px;
        background: #e9ecef;
        overflow: hidden;
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
        border-radius: 15px;
        transition: width 1s ease-out;
        font-weight: 600;
        font-size: 1rem;
        animation: progress-fill 1.5s ease-out;
    }

    @keyframes progress-fill {
        from { width: 0%; }
    }

    .progress-bar.bg-danger {
        background: linear-gradient(90deg, #f5576c, #ff6b6b) !important;
    }

    .progress-bar.bg-success {
        background: linear-gradient(90deg, #37b24d, #51cf66) !important;
    }

    /* List Group */
    .list-group-item {
        border: none;
        border-left: 4px solid #667eea;
        margin-bottom: 10px;
        border-radius: 10px;
        background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
        transition: all 0.3s ease;
    }

    .list-group-item:hover {
        transform: translateX(10px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    /* Card Titles */
    .card-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 15px;
        position: relative;
        padding-bottom: 10px;
    }

    .card-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 2px;
    }

    /* Image Containers */
    .card img {
        border-radius: 12px;
        transition: all 0.3s ease;
        border: 2px solid #e9ecef;
    }

    .card img:hover {
        transform: scale(1.02);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border-color: #667eea;
    }

    /* Download Button */
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
    }

    .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }

    .btn-primary:hover::before {
        left: 100%;
    }

    .btn-outline-secondary {
        border-radius: 20px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.2);
    }

    /* Pre/Code Block */
    pre {
        border-radius: 12px;
        border: 2px solid #e9ecef;
        max-height: 400px;
        overflow-y: auto;
        font-size: 0.9rem;
        line-height: 1.6;
        animation: slide-in 0.5s ease-out;
    }

    @keyframes slide-in {
        from {
            opacity: 0;
            max-height: 0;
        }
        to {
            opacity: 1;
            max-height: 400px;
        }
    }

    pre::-webkit-scrollbar {
        width: 8px;
    }

    pre::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    pre::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 10px;
    }

    /* Alert Animations */
    h4 {
        font-size: 1.8rem;
        font-weight: 700;
        animation: alert-slide 0.6s ease-out;
    }

    @keyframes alert-slide {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        #content {
            padding: 20px 15px;
        }

        h2 {
            font-size: 2rem;
        }

        h4 {
            font-size: 1.4rem;
        }

        .card h3 {
            font-size: 2rem;
        }

        .badge {
            font-size: 0.85rem;
            padding: 6px 12px;
        }

        .btn-primary {
            padding: 10px 20px;
            font-size: 0.95rem;
        }
    }

    /* Smooth Page Transitions */
    * {
        scroll-behavior: smooth;
    }

    /* Text Muted Enhancement */
    .text-muted {
        color: #718096 !important;
        font-size: 0.95rem;
    }

    /* Row Spacing */
    .row {
        animation: fade-in-up 0.8s ease-out;
    }

    @keyframes fade-in-up {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

{% endblock %}